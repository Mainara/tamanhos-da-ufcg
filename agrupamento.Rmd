---
title: "Agrupamento sobre dados da UFCG"
output: html_notebook
---

Nessa análise, iremos dividir as Unidades Acadêmicas da UFCG em diferentes grupos, as variáveis utilizadas para fazer esse agrupamento serão exploradas a seguir. Antes de visualizar os dados é importante saber que **percentis**  são medidas que dividem a amostra ordenada (por ordem crescente dos dados) em 100 partes, cada uma com uma percentagem de dados aproximadamente igual.

```{r, echo=FALSE, warning=FALSE}
suppressWarnings(library(tidyverse))
suppressWarnings(library(plotly))
suppressWarnings(library(cluster))
ufcg_uas_sumario = read_csv("ufcg-201704-sumario-UAs-wide.csv", 
                            col_types = cols(
                                UORG_LOTACAO = col_character(),
                                Outro = col_double(),
                                `Professor 20h` = col_double(),
                                `Professor 40h ou DE` = col_double(),
                                idade_25perc = col_double(),
                                idade_mediana = col_double(),
                                idade_75perc = col_double()
                            )
)
```

#### Funcionários na UA que não são professores

```{r}
p = ggplot(ufcg_uas_sumario, aes(x=UORG_LOTACAO, 
             y=Outro,
             text = paste("UA:",UORG_LOTACAO,
                            "\nQuantidade:",
                            Outro))) +
     labs(title = "Funcionários que não são professores", y = "Quantidade", x = "UA")+
    theme(legend.position="none") +
  geom_point(colour = "#882C3E") + coord_flip()
ggplotly(p, tooltip = "text")
```


#### Professores com carga horária 20h/semana

```{r}
p = ggplot(ufcg_uas_sumario, aes(x=UORG_LOTACAO, 
             y=`Professor 20h`,
             text = paste("UA:",UORG_LOTACAO,
                            "\nQuantidade:",
                            `Professor 20h`))) +
     labs(title = "Professores com carga horária 20h/semana", y = "Quantidade", x = "UA")+
    theme(legend.position="none") +
  geom_point(colour = "#50dd66") + coord_flip()
ggplotly(p, tooltip = "text")
```
Aqui, vemos que a maioria das Unidade Acadêmicas não possui nenhum professor com carga horária de 20h/semana, mas a *Unidade Acadêmica de Medicina* chama atenção com 65 professores com essa carga horária.

#### Professores com carga horária 40h/semana na UA, sejam eles Dedicação Exclusiva ou não

```{r}
p = ggplot(ufcg_uas_sumario, aes(x=UORG_LOTACAO, 
             y=`Professor 40h ou DE`,
             text = paste("UA:",UORG_LOTACAO,
                            "\nQuantidade:",
                            `Professor 40h ou DE`))) +
     labs(title = "Professores com carga horária 40h/semana, sejam eles Dedicação Exclusiva ou não", y = "Quantidade", x = "UA")+
    theme(legend.position="none") +
  geom_point(colour = "#ED6471") + coord_flip()
ggplotly(p, tooltip = "text")
```


#### 25 percentil da idade dos funcionários *no cargo* 

```{r}
p = ggplot(ufcg_uas_sumario, aes(x=UORG_LOTACAO, 
             y=idade_25perc,
             text = paste("UA:",UORG_LOTACAO,
                            "\n25 percentil:",
                            idade_25perc))) +
     labs(title = "25 percentil da idade dos funcionários no cargo", y = "25 Percentil", x = "UA")+
    theme(legend.position="none") +
  geom_point(colour = "#b0b3cc") + coord_flip()
ggplotly(p, tooltip = "text")
```

*Exemplo de interpretação: Na Unidade Acadêmica de Engenharia de Materiais, 25% dos funcionários tem 21.73 anos ou menos na profissão.*

#### Idade mediana dos funcionários *no cargo* 

```{r}
p = ggplot(ufcg_uas_sumario, aes(x=UORG_LOTACAO, 
             y=idade_mediana,
             text = paste("UA:",UORG_LOTACAO,
                            "\nIdade Mediana:",
                            idade_mediana))) +
     labs(title = "Idade mediana dos funcionários no cargo", y = "Idade mediana", x = "UA")+
    theme(legend.position="none") +
  geom_point(colour = "#5f6694") + coord_flip()
ggplotly(p, tooltip = "text")
```

A maioria dos funcionários no cargo está entre 6 e 9.

#### 75 percentil da idade dos funcionários *no cargo* 

```{r}
p = ggplot(ufcg_uas_sumario, aes(x=UORG_LOTACAO, 
             y=`idade_75perc`,
             text = paste("UA:",UORG_LOTACAO,
                            "\n75 percentil:",
                            `idade_75perc`))) +
     labs(title = "75 percentil dos funcionários no cargo", y = "75 percentil", x = "UA")+
    theme(legend.position="none") +
  geom_point(colour = "#12131c") + coord_flip()
ggplotly(p, tooltip = "text")
```


*Exemplo de interpretação: Na Unidade Acadêmica de Sistemas e computação, 75% dos funcionários tem 22.09 anos ou menos na profissão.*


### Escolha do número K

#### GAP statistic

```{r}
plot_clusgap = function(clusgap, title="Gap Statistic calculation results"){
    require("ggplot2")
    gstab = data.frame(clusgap$Tab, k=1:nrow(clusgap$Tab))
    p = ggplot(gstab, aes(k, gap)) + geom_line(colour = "#292c40") + geom_point(size=5, colour = "#292c40")
    p = p + geom_errorbar(aes(ymax=gap+SE.sim, ymin=gap-SE.sim), colour = "#292c40", width = .2)
    p = p + ggtitle(title)
    return(p)
}

ufcg.scaled = ufcg_uas_sumario %>% 
    select(-UORG_LOTACAO)

gaps <- ufcg.scaled %>% 
    clusGap(FUN = kmeans,
            nstart = 20,
            K.max = 8,
            B = 200)
plot_clusgap(gaps)

```

Segundo essa estatística, 8 seria o valor de K ideal.

### K-means

```{r}
km = kmeans(ufcg.scaled, 
            centers = 8, 
            nstart = 100)

km

plot(ufcg.scaled)
```
